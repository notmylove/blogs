# 层次分析法
针对上述学员的问题，这里重新记录一下层次分析法的过程以及改进的模糊层次分析法

## 层次分析法的步骤
层次分析法，简称AHP，是指将与决策总是有关的元素分解成目标、准则、方案等层次，在此基础之上进行定性和定量分析的决策方法。是对一些较为复杂、
较为模糊的问题作出决策的简易方法，适用于那些难于完全定量分析的问题。

运用层次分析法建模，大体上可按下面四个步骤进行： 
- 建立递阶层次结构模型； 
- 构造出各层次中的所有判断矩阵； 
- 层次单排序及一致性检验； 
- 层次总排序及一致性检验。 

### 建立层次结构模型
层次分析法是用来根据多种准则，或是说因素从候选方案中选出最优的一种数学方法

![](https://s2.ax1x.com/2019/06/27/Zno7Ks.png)

也就是层次结构分为三个部分：目标层、准则层以及方案层，给目标层分配值为1.0，然后将这一值作为权重，分配给不同因素，
对应因素的权重大小代表该因素在整个选择过程中的重要性程度。
然后对于候选方案，准则层每一个因素再将其权重值分配给所有的候选方案，每一方案获得权重值，来源于不同因素分得的权重值的和。
**最终获得的各个方案的的权重值的和依然为1**

![](https://s2.ax1x.com/2019/06/27/Znobbq.png)

接下来就是权重分配的问题：

- 1.每个准则（因素）权重具体应该分配多少？

- 2.每一个候选方案在每一个因素下又应该获得多少权重？

这是层次分析法的关键所在。

### 每个准则权重分配问题
如果直接要给各个因素分配权重比较困难，但在不同因素之间两两比较其重要程度是相对容易的，因此，层次分析法使用九标度法对两因素之间的重要性进行打分，
其中这里如果没有定量数据则需要通过经验进行打分，后面有实例讲解。

九标度法：

![](https://s2.ax1x.com/2019/06/27/Zn7kOs.png)

通过使用九标度法对两两因素进行比较，我们可以得到**判断矩阵**(主对角为1)，接下来涉及到两个矩阵定义：

- 正互反矩阵：

![](https://s2.ax1x.com/2019/06/27/Znoovj.png)

- 一致性矩阵：

![](https://s2.ax1x.com/2019/06/27/ZnoI2Q.png)

首先，我们得到的判断矩阵是一个正互反矩阵，但不满足一致性，因此不是一致性矩阵。比如我们做因素1：因素2 = 4：1 ，因素2：因素3=2:1 ，
因素1：因素3=6:1（如果满足一致性就应该是8:1），我们就是因为难以确定各因素比例分配才做两两比较的，如果认为判断中就能保证一致性，就直接给出权重分配了。

一致性矩阵有一个性质就是：

![](https://s2.ax1x.com/2019/06/27/Zno58g.png)

这里的W就是我们要求的权重，所以通过求判断矩阵的最大特征值所对应的特征向量，归一化之后就可以获得不同因素的权重
注意，由于我们给出的比较矩阵一般是不满足一致性的，但是我们还是把它当做一致矩阵来处理，也可以获得一组权重，但是这组权重能不能被接受，需要进一步考量。
这就是为什么后面会有改进的模糊层次分析法了（即下文阐述的一致性检验）

### 一致性检验
当写出来判断矩阵之后还会存在一个问题，那就是按理来说如果i对j的重要程度是a，j对k的重要程度是b，那么理所应当i对k的重要程度应该a*b，
有点符合“传递性”的感觉。但事实上不是这样的。所以需要进行一致性检验，如果在一定的合理范围之内，矩阵不需要修改，如果不在，则需要修改矩阵。
我们可以由λmax（最大特征值）是否等于 n 来检验判断矩阵 A 是否为一致矩阵。由于特征根连续地依赖于aij ，故 λmax 比 n 大得越多， A 的非一致性程度也就越严重，
λmax 对应的标准化特征向量也就越不能真实地反映出 因素在对目标的影响中所占的比重。因此，对决策者提供的判断矩阵有必要作一次一致性检验，
以决定是否能接受它。

一致性的检验是通过计算一致性比例CR来进行的:

**CR = CI/RI**

当CR<0.10 时，认为判断矩阵的一致性是可以接受的，否则应对判断矩阵作适当修正。 
CI的值(λmax-n/(n-1))由判断矩阵计算获得，RI的值查表获得，重点是理解为什么要做一致性检验（模糊层次分析法就不需要一致性检验）。

### 每一个候选方案在每一个因素下的权重分配

这里则需要将不同候选方案，在不同因素下分别比较，具体的方法还是同上述一样构造判断矩阵，只不过之前准则层的比较矩阵比较的对象是因素，
这里比较的是某一因素下，候选方案的优劣， n个因素则需构造出来n个比较矩阵。

最终将每个候选方案从不同因素获得的权值求和，就可以得到不同候选对于目标层的权值大小，继而可以根据值的大小，来选出优劣。

### 总结
- 通过对层次分析法的基本了解，不难发现层次分析法对人们的思维过程进行了加工整理，提出了一套系统分析问题的方法，为
科学管理和决策提供了较有说服力的依据。  

- 但很明显的缺点是，整个分析过程似乎都是依赖于人的主观判断思维，一来不够客观，
，还是非常耗费精力的，尤其是当候选方案比较多的时候。

- 需要进行一致性检验

### 实例讲解
前面讲到，对于不能完全通过定量分析的问题，可以使用层次分析法。然后再介绍层次分析法的变形应用，定量与定性结合分析。

#### 实例1
有一个毕业生为挑选合适的工作。经双方恳谈，已有三个单位表示愿意录用某毕业生，该毕业生考虑的因素有6个，研究课题、发展前途、待遇、同事情况、地理位置和单位名气。 
那么这六个因素就是准则层，三个单位就是方案层，最后要求的就是应该去哪个单位。

- 准则层判断矩阵（主观性） 

![](https://s2.ax1x.com/2019/06/27/ZnoHrn.png)

- 方案层判断矩阵（主观性）

![](https://s2.ax1x.com/2019/06/27/ZnoLV0.png)

求出判断矩阵的最大特征值对应的特征向量，然后做一致性检验即可。

#### 实例2
- 目标：选出最优教练
- 准则：  

1. 职业生涯所带队伍的胜率      

2. 职业生涯所带队伍的胜场            

3. 从教时长（年）          

4. 职业生涯所带队伍获奖状况（化成分数）

- 候选：众多教练

**一.** 首先准则层的判断矩阵构造由于没有定量数据，因此使用九标度法进行打分。作6次两两比较，就可以获得4*4的判断矩阵。

**二.** 候选层的判断矩阵构造方法就不同了，由于每个教练对应的四个准则都有定量数据，因此，可以使用每个教练对应的准则数据值的比值来构造判断矩阵，
如：例如教练 A, B职业生涯所带队伍胜场数为 100， 90，那么此时该准则下得到的分数就用100:90来划分。因此，候选层的判断矩阵的构造就不是基于经验，而是基于准确的数值，而且还有一个特别重要的优势是：这里的用定量数据作比获得的矩阵显然满足一致性要求，不需要做一致性检验（有疑问的可以自己去验证）。

这里有一点需要注意的是：不同因素下数据的量纲和性质不一样，直接用数据作比来分配，不一定合适，比如胜率越要接近1越难，0.7比胜率0.5 和胜率0.9比0.7，
后者比值比前者小，这显然不合适。这里可以进行数据预处理（在数据挖掘、机器学习应用中，这也是关键一步）， 例如这里可以对数据取对数，再作为权重分配的依据。

（这里MATLAB相关的程序代码就不上传了，有需要可以找我）

接下来再来说说**改进的模糊层次分析法**

由于github上不支持latex公式，因此具体内容写在[改进的模糊层次分析法](https://www.zybuluo.com/notmylove/note/1503606)


